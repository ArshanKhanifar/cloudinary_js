<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>cloudinary_js</title>
    <link rel="shortcut icon" type="image/png"
          href="../bower_components/jasmine/images/jasmine_favicon.png">

    <link rel="stylesheet" type="text/css"
          href="../bower_components/jasmine/lib/jasmine-core/jasmine.css">
    <script type="text/javascript"
            src="../bower_components/jasmine/lib/jasmine-core/jasmine.js"></script>
    <script type="text/javascript"
            src="../bower_components/jasmine/lib/jasmine-core/jasmine-html.js"></script>
    <script type="text/javascript"
            src="../bower_components/jasmine/lib/jasmine-core/boot.js"></script>
    <script>
        window.bootJasmine = window.onload;
        window.onload = undefined;
    </script>
    <script src="../bower_components/requirejs-bower/require.js"></script>
    <script>
        define('tree', [],function(){
            // Usage:
// Put this in a separate file and load it as the first module
// (See https://github.com/jrburke/requirejs/wiki/Internal-API:-onResourceLoad)
// Methods available after page load:
// rtree.map()
// - Fills out every module's map property under rtree.tree.
// - Print out rtree.tree in the console to see their map property.
// rtree.toUml()
// - Prints out a UML string that can be used to generate UML
// - UML Website: http://yuml.me/diagram/scruffy/class/draw
            requirejs.onResourceLoad = function (context, map, depMaps) {
                if (!window.rtree) {
                    window.rtree = {
                        tree: {},
                        map: function() {
                            for (var key in this.tree) {
                                if (this.tree.hasOwnProperty(key)) {
                                    var val = this.tree[key];
                                    for (var i =0; i < val.deps.length; ++i) {
                                        var dep = val.deps[i];
                                        val.map[dep] = this.tree[dep];
                                    }
                                }
                            }
                        },
                        toUml: function() {
                            var uml = [];

                            for (var key in this.tree) {
                                if (this.tree.hasOwnProperty(key)) {
                                    var val = this.tree[key];
                                    for (var i = 0; i < val.deps.length; ++i) {
                                        uml.push("[" + key + "]->[" + val.deps[i] + "]");
                                    }
                                }
                            }

                            return uml.join("\n");
                        }
                    };
                }

                var tree = window.rtree.tree;

                function Node() {
                    this.deps = [];
                    this.map = {};
                }

                if (!tree[map.name]) {
                    tree[map.name] = new Node();
                }

                // For a full dependency tree
                if (depMaps) {
                    for (var i = 0; i < depMaps.length; ++i) {
                        tree[map.name].deps.push(depMaps[i].name);
                    }
                }

// For a simple dependency tree

//    if (map.parentMap && map.parentMap.name) {
//        if (!tree[map.parentMap.name]) {
//            tree[map.parentMap.name] = new Node();
//        }
//
//        if (map.parentMap.name !== map.name) {
//            tree[map.parentMap.name].deps.push(map.name);
//        }
//    }

            };
            console.log("defined tree");
        })
    </script>
    <script>
        requirejs.config({
            //By default load any module IDs from js/lib
            baseUrl: '../src',
            //except, if the module ID starts with "app",
            //load it from the js/app directory. paths
            //config is relative to the baseUrl, and
            //never includes a ".js" extension since
            //the paths config could be for a directory.
            paths: {
                lodash: '../bower_components/lodash/lodash',
                spec: '../test/spec',
                util: 'util/lodash'
            }
        });
        require(['tree','cloudinary'], function (cloudinary) {
            window.cloudinary = cloudinary;
            require(['spec/chaining-spec', 'spec/cloudinary-spec', 'spec/tagspec', 'spec/videourlspec'], function () {
                console.trace();
//                bootJasmine();
                rtree.map();
            })
        })
    </script>
</head>
<body>

</body>
</html>